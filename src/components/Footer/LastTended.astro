---
interface Props {
  dateModified: Date | null;
}

const { dateModified } = Astro.props;
---

<last-tended data-modified={dateModified}>
  <!-- <Icon icon="seedling" size="small" className={styles.lastTendedIcon} /> -->
  <small>Last tended <time>at some point in time</time></small>
</last-tended>

<script>
  // FIX: This is broken again, because the icon kept returning 'null' and crashing Astro
  // for unknown reasons. Now it's broken in other, more different ways.
  import dayjs from "dayjs";
  import advancedFormat from "dayjs/plugin/advancedFormat";
  import localizedFormat from "dayjs/plugin/localizedFormat";
  import relativeTime from "dayjs/plugin/relativeTime";
  import timezone from "dayjs/plugin/timezone";
  import utc from "dayjs/plugin/utc";

  dayjs.extend(utc);
  dayjs.extend(timezone); // Support 'z' to display timezone
  dayjs.extend(localizedFormat); // Support 'LLLL' to display full date
  dayjs.extend(advancedFormat); // Support 'z' to display timezone
  dayjs.extend(relativeTime); // Support .fromNow()

  class LastTended extends HTMLElement {
    constructor() {
      super();

      const dateModified = this.dataset.modified;
      const timeElement = this.querySelector("time");

      if (timeElement) {
        timeElement.dateTime = dayjs(dateModified).format();
        timeElement.title = dayjs(dateModified)
          .tz("America/New_York", true)
          .format("LLLL z");
        timeElement.textContent = dayjs(dateModified).fromNow();
      }
    }
  }

  customElements.define("last-tended", LastTended);
</script>
