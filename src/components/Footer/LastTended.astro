---
import { formatDistanceToNow } from "date-fns";
import * as styles from "./footer.css";

// Vercel Access Token
const accessToken =
  import.meta.env.VERCEL_ACCESS_TOKEN ?? process.env.VERCEL_ACCESS_TOKEN;

// Fetch evadecker.com Vercel project
const projectId = "prj_pMk8EbUuHxsj51ERiVXZyANy9ZPC";
// Fetch only READY deploys
const state = "READY";
// Fetch only production deploys
const target = "production";

let lastDeployedTime: string;
try {
  // https://vercel.com/docs/rest-api/endpoints#list-deployments
  const response = await fetch(
    `https://api.vercel.com/v6/deployments?projectId=${projectId}&state=${state}&target=${target}`,
    {
      method: "GET",
      headers: {
        Authorization: `Bearer ${accessToken}`,
      },
    }
  );

  const data = await response.json();

  const { ready } = data.deployments[0];

  lastDeployedTime = formatDistanceToNow(ready, { addSuffix: true });
} catch (error) {
  lastDeployedTime = "at some point in time";
}
---

<small class={styles.lastTended}>
  Last tended <strong>{lastDeployedTime}</strong>
</small>
