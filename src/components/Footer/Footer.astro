---
import Center from "../Center.astro";
import Grid from "../Grid.astro";
import { Icon } from "../Icon/Icon";
import { RelativeDate } from "../RelativeDate/RelativeDate";
import Stack from "../Stack.astro";

// Vercel Access Token
const accessToken = import.meta.env.VERCEL_ACCESS_TOKEN;
// Fetch evadecker.com Vercel project
const projectId = "prj_pMk8EbUuHxsj51ERiVXZyANy9ZPC";
// Fetch only READY deploys
const state = "READY";
// Fetch only production deploys
const target = "production";
// Fetch only latest
const limit = 1;

let dateModified: Date | null = null;

try {
  // https://vercel.com/docs/rest-api/endpoints#list-deployments
  const response = await fetch(
    `https://api.vercel.com/v6/deployments?projectId=${projectId}&state=${state}&target=${target}&limit=${limit}`,
    {
      method: "GET",
      headers: {
        Authorization: `Bearer ${accessToken}`,
      },
    }
  );
  const data = await response.json();
  const { ready } = data.deployments[0];
  dateModified = new Date(ready);
} catch (error) {
  dateModified = null;
}
---

<footer transition:animate="fade">
  <RelativeDate date={dateModified} prefix="Last tended" icon="sparkling" />

  <div class="links">
    <div class="pages">
      <a href="/about">About</a>
      <a href="/colophon">Colophon</a>
    </div>
    <div class="social">
      <a
        href="https://github.com/evadecker"
        target="_blank"
        aria-label="Visit Eva's GitHub"
      >
        <Icon icon="github" variant="filled" />
      </a>
      <a
        href="https://linkedin.com/in/evadecker"
        target="_blank"
        aria-label="Visit Eva's LinkedIn"
      >
        <Icon icon="linkedInBox" variant="filled" />
      </a>
    </div>
  </div>
</footer>

<style>
  footer {
    background: var(--mauve-2);
    border-top: 1px solid var(--mauve-6);
    font-size: var(--text-small);
    width: 100%;
    padding-block: 0.5rem;
    padding-inline-start: 1.5rem;
    padding-inline-end: 1.5rem;
    display: flex;
    align-items: center;
  }

  .links {
    display: flex;
    align-items: center;
    line-height: 1;
    margin-inline-start: auto;
  }

  .pages,
  .social {
    display: flex;
    align-items: center;
  }

  @media (width <= 600px) {
    .links {
      flex-direction: column;
      align-items: flex-end;
    }
  }

  .links a {
    padding: 0.5rem;
    display: inline-block;
  }

  .links a:hover {
    color: var(--pink-9);
  }
</style>
