---
import { Image } from "astro:assets";
import type { CollectionEntry } from "astro:content";

interface Props {
  project: CollectionEntry<"work">;
}

const { project } = Astro.props;

const { data, render } = project;

const { title, img, video, url, timeline } = data;
const { Content } = await render();
---

<div class="project">
  <div class="details">
    <time>{timeline.start}&ndash;{timeline.end}</time>
    <h2>{title}</h2>
    <Content />
  </div>
  {
    (img ?? video) && (
      <div class="media">
        {img && <Image src={img.src} alt={img.alt} class="img" />}
        {video && (
          <video
            autoplay
            loop
            muted
            playsinline
            preload="none"
            poster={video.poster}
          >
            <source src={video.src} type="video/mp4" />
          </video>
        )}
      </div>
    )
  }
  {
    url && (
      <a class:list={["link", { disabled: url === undefined }]} href={url}>
        Read the case study
      </a>
    )
  }
</div>

<style lang="scss">
  .project {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    position: relative;
    gap: var(--space-l);
  }

  .details time {
    color: var(--gray-11);
  }

  .details h2 {
    margin-block: var(--space-xs) var(--space-s);
  }

  .details :global(p) {
    font-size: var(--step-1);
    line-height: 1.3;
  }

  .details :global(a) {
    position: relative;
    text-decoration: underline;
    text-decoration-color: var(--gray-8);
    text-underline-offset: 0.1em;
    transition: text-decoration-color 0.2s ease-in-out;

    @media (hover: hover) {
      &:hover {
        text-decoration-color: var(--gray-11);
      }
    }
  }

  .media {
    width: 100%;
    max-width: 100%;
    line-height: 0;
    position: relative;
    border-radius: var(--radius-m);
    overflow: hidden;

    &::after {
      content: "";
      position: absolute;
      inset: 0;
      border: 1px solid var(--gray-a3);
      border-radius: var(--radius-m);
    }
  }

  .description {
    line-height: 1.3;
  }

  .link {
    border: 1px solid var(--gray-a5);
    padding: var(--space-s) var(--space-m);
    border-radius: var(--radius-s);
    font-weight: var(--font-weight-medium);

    @media (hover: hover) {
      &:hover {
        border-color: var(--gray-a7);
      }
    }
  }
</style>
