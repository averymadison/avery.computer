---
import { Image } from "astro:assets";

import { smartquotes } from "../helpers/helpers";
import { Icon } from "./Icon/Icon";

interface Props {
  title: string;
  description: string;
  datePublished: Date;
  url?: string;
  repo?: string;
  img?: ImageMetadata;
  imgAlt?: string;
  disabled?: boolean;
}

const { title, description, url, repo, img, imgAlt, disabled } = Astro.props;
---

<div class:list={["project", { disabled }]}>
  {
    img && imgAlt && (
      <a class="img" href={url}>
        <Image src={img} alt={imgAlt} />
      </a>
    )
  }
  <div class="details">
    <a class="title" href={url}>
      <h3>{title}</h3>
    </a>
    <div class="description">
      {smartquotes(description)}
    </div>
    <footer class="links">
      {
        url && (
          <a class="link" href={url}>
            <Icon icon="link" size="16" />
            <span class="url">{url.replace(/^https?:\/\//, "")}</span>
          </a>
        )
      }
      {
        repo && (
          <a class="link" href={`https://github.com/${repo}`}>
            <Icon icon="github" size="16" />
            <span class="url">{repo}</span>
          </a>
        )
      }
    </footer>
  </div>
</div>

<style lang="scss">
  .project {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    background-color: var(--gray-3);
    border-radius: var(--radius-m);
    overflow: hidden;
    position: relative;

    &::before {
      content: "";
      position: absolute;
      inset: 0;
      border: 1px solid var(--gray-a3);
      border-radius: var(--radius-m);
      pointer-events: none;
    }

    &.disabled {
      opacity: 0.5;
    }
  }

  .details {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    gap: var(--space-2xs);
    padding: var(--space-m);
    width: 100%;
  }

  .img {
    background-color: var(--gray-3);
    width: 100%;
    display: block;
    line-height: 0;
  }

  .title h3 {
    font-size: var(--step-1);
  }

  .description {
    line-height: 1.3;
  }

  .links {
    display: flex;
    flex-flow: row wrap;
    max-width: 100%;
    column-gap: var(--space-m);
    font-size: var(--step--1);
  }

  .link {
    display: flex;
    align-items: center;
    gap: var(--space-2xs);
    color: var(--gray-11);
    padding-block: var(--space-2xs);
    max-width: 100%;
    line-height: 1.1;

    &:hover {
      color: var(--gray-12);
      text-decoration: underline;
      text-decoration-color: var(--gray-7);
      text-underline-offset: 0.1em;
    }

    .url {
      word-wrap: break-word;
      min-width: 1%;
    }
  }
</style>
