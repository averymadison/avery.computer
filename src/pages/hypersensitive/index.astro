---
import UnstyledBase from "../../layouts/UnstyledBase.astro";
---

<UnstyledBase
  title="HYPERSENSITIVE"
  description="It’s all too much."
  ogImage="/images/hypersensitive.png"
  ogAlt="The event is too bright. The city is too uncomfortable. The brain is too humid. The light is too nervous."
>
  <main id="canvas"></main>
</UnstyledBase>

<script>
  const affirmation = "it’s all going to be okay";

  const attribute = [
    ["everything", "is"],
    ["it’s", "all"],
    ["the", "ads", "are"],
    ["the", "air", "is"],
    ["the", "apps", "are"],
    ["the", "atmosphere", "is"],
    ["the", "bars", "are"],
    ["the", "brain", "is"],
    ["the", "buildings", "are"],
    ["the", "bus", "is"],
    ["the", "cars", "are"],
    ["the", "chair", "is"],
    ["the", "city", "is"],
    ["the", "climate", "is"],
    ["the", "clothes", "are"],
    ["the", "colors", "are"],
    ["the", "construction", "is"],
    ["the", "conversation", "is"],
    ["the", "crowds", "are"],
    ["the", "discussion", "is"],
    ["the", "dreams", "are"],
    ["the", "electricity", "is"],
    ["the", "emails", "are"],
    ["the", "environment", "is"],
    ["the", "event", "is"],
    ["the", "experience", "is"],
    ["the", "eye contact", "is"],
    ["the", "feet", "are"],
    ["the", "food", "is"],
    ["the", "furniture", "is"],
    ["the", "future", "is"],
    ["the", "honking", "is"],
    ["the", "humming", "is"],
    ["the", "images", "are"],
    ["the", "information", "is"],
    ["the", "internet", "is"],
    ["the", "lights", "are"],
    ["the", "machines", "are"],
    ["the", "messages", "are"],
    ["the", "motion", "is"],
    ["the", "mouthfeel", "is"],
    ["the", "movements", "are"],
    ["the", "movies", "are"],
    ["the", "music", "is"],
    ["the", "news", "is"],
    ["the", "noises", "are"],
    ["the", "objects", "are"],
    ["the", "office", "is"],
    ["the", "parties", "are"],
    ["the", "past", "is"],
    ["the", "people", "are"],
    ["the", "phone calls", "are"],
    ["the", "phones", "are"],
    ["the", "pictures", "are"],
    ["the", "pipes", "are"],
    ["the", "places", "are"],
    ["the", "programs", "are"],
    ["the", "prospect", "is"],
    ["the", "restaurants", "are"],
    ["the", "roads", "are"],
    ["the", "room", "is"],
    ["the", "screens", "are"],
    ["the", "sensation", "is"],
    ["the", "shops", "are"],
    ["the", "show", "is"],
    ["the", "smells", "are"],
    ["the", "sounds", "are"],
    ["the", "space", "is"],
    ["the", "streets", "are"],
    ["the", "talking", "is"],
    ["the", "taste", "is"],
    ["the", "temperature", "is"],
    ["the", "text", "is"],
    ["the", "textures", "are"],
    ["the", "thoughts", "are"],
    ["the", "touch", "is"],
    ["the", "traffic", "is"],
    ["the", "trains", "are"],
    ["the", "travel", "is"],
    ["the", "trucks", "are"],
    ["the", "TV", "is"],
    ["the", "videos", "are"],
    ["the", "voices", "are"],
    ["the", "walk", "is"],
    ["the", "walls", "are"],
    ["the", "wealth", "is"],
    ["the", "weather", "is"],
    ["the", "website", "is"],
    ["the", "words", "are"],
  ];

  const quality = [
    "abrasive",
    "acidic",
    "aggressive",
    "all-consuming",
    "angry",
    "backwards",
    "big",
    "bitter",
    "boomy",
    "bright",
    "ceaseless",
    "chalky",
    "chaotic",
    "clammy",
    "clangy",
    "claustrophobic",
    "close",
    "cloying",
    "cold",
    "complex",
    "confining",
    "confusing",
    "cramped",
    "crowded",
    "damp",
    "dangerous",
    "deafening",
    "demanding",
    "dense",
    "discordant",
    "disjointed",
    "disordered",
    "disorienting",
    "dissonant",
    "distorted",
    "distressing",
    "dizzying",
    "dusty",
    "excessive",
    "exhausting",
    "fast",
    "flickery",
    "forced",
    "fragrant",
    "giant",
    "grating",
    "greasy",
    "harsh",
    "heavy",
    "hectic",
    "high-pitched",
    "humid",
    "hurried",
    "illegible",
    "illogical",
    "impatient",
    "impenetrable",
    "inescapable",
    "inhospitable",
    "intense",
    "intrusive",
    "itchy",
    "jarring",
    "jittery",
    "littered",
    "looming",
    "loud",
    "messy",
    "metallic",
    "much",
    "muddy",
    "mushy",
    "musty",
    "narrow",
    "nauseating",
    "nervous",
    "noisy",
    "nonsensical",
    "oily",
    "packed",
    "painful",
    "pressing",
    "prickly",
    "rapid",
    "repetitive",
    "restless",
    "rigid",
    "rough",
    "rumbly",
    "rushed",
    "scratchy",
    "screeching",
    "sensational",
    "shaky",
    "sharp",
    "shouty",
    "shrill",
    "slimy",
    "smelly",
    "spiky",
    "squeaky",
    "starchy",
    "stifling",
    "stinky",
    "stuffy",
    "sudden",
    "suffocating",
    "synthetic",
    "talkative",
    "tight",
    "tingly",
    "tiring",
    "uncanny",
    "uncomfortable",
    "unexpected",
    "unhygienic",
    "unnatural",
    "vibrant",
    "vibratey",
    "violent",
    "vivid",
    "warm",
    "wet",
  ];

  function getRandomValueWithinRange(min: number, max: number): number {
    return Math.random() * (max - min) + min;
  }

  function writeAffirmation(): void {
    let canvasDOMElem = document.getElementById("canvas");
    if (!canvasDOMElem) return;

    const fragment = document.createDocumentFragment();

    let affirmationWrapper = fragment.appendChild(
      document.createElement("div")
    );
    affirmationWrapper.classList.add("affirmation");

    const timer = (ms: number) => new Promise((res) => setTimeout(res, ms));

    async function load() {
      for (let i = 0; i < affirmation.length; i++) {
        affirmationWrapper.textContent += affirmation[i];

        await timer(getRandomValueWithinRange(60, 120));
      }
    }

    canvasDOMElem.appendChild(affirmationWrapper);

    load();
  }

  writeAffirmation();

  function generateSentence(): string {
    const randomAttribute =
      attribute[Math.floor(Math.random() * attribute.length)];
    const randomQuality = quality[Math.floor(Math.random() * quality.length)];
    return [...randomAttribute, "too", randomQuality].join(" ");
  }

  function writeSentence(): void {
    let canvasDOMElem = document.getElementById("canvas");
    if (!canvasDOMElem) return;

    const fragment = document.createDocumentFragment();

    let sentenceWrapper = fragment.appendChild(document.createElement("div"));
    sentenceWrapper.classList.add("sentence-wrapper");

    // Inline text
    let sentence = sentenceWrapper.appendChild(document.createElement("p"));
    sentence.classList.add("sentence");
    sentence.style.fontSize = `${getRandomValueWithinRange(1, 1.2)}em`;
    sentence.style.fontStretch = `${getRandomValueWithinRange(40, 80)}%`;
    sentence.style.color = `hsl(${Math.random() * 360}, 100%, 50%)`;
    sentence.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 10%)`;

    sentence.textContent = generateSentence();

    canvasDOMElem.appendChild(sentenceWrapper);

    // Positioning
    // (Must take place after the element has been added to the DOM)
    const viewportWidth = window.innerWidth;
    const viewportHeight = window.innerHeight;

    const elementWidth = sentenceWrapper.offsetWidth;
    const elementHeight = sentenceWrapper.offsetHeight;

    const maxX = viewportWidth - elementWidth;
    const maxY = viewportHeight - elementHeight;

    const randomX = Math.floor(Math.random() * maxX);
    const randomY = Math.floor(Math.random() * maxY);

    sentenceWrapper.style.left = `${randomX}px`;
    sentenceWrapper.style.top = `${randomY}px`;
    sentenceWrapper.style.transform = `rotate(${(Math.random() - 0.5) * 10}deg)`;
  }

  function setRandomInterval(
    intervalFunction: () => void,
    minDelay: number,
    maxDelay: number
  ) {
    let timeout: NodeJS.Timeout;

    const runInterval = () => {
      const timeoutFunction = () => {
        intervalFunction();
        runInterval();
      };

      const delay =
        Math.floor(Math.random() * (maxDelay - minDelay + 1)) + minDelay;

      timeout = setTimeout(timeoutFunction, delay);
    };

    runInterval();

    return {
      clear() {
        clearTimeout(timeout);
      },
    };
  }

  setTimeout(() => {
    setRandomInterval(writeSentence, 300, 2400);
  }, 2000);
</script>

<style is:global lang="scss">
  html,
  body {
    background: #111;
  }

  #canvas {
    position: relative;
    height: 100dvh;
    width: 100vw;
    overflow: hidden;
    padding: var(--space-l);
    font-family:
      system-ui,
      -apple-system,
      BlinkMacSystemFont,
      "Segoe UI",
      Roboto,
      Oxygen,
      Ubuntu,
      Cantarell,
      "Open Sans",
      "Helvetica Neue",
      sans-serif;
    font-weight: 500;
    font-size: 40px;
    line-height: 1;

    @media (width < 960px) {
      font-size: 32px;
    }

    @media (width < 640px) {
      font-size: 28px;
    }
  }

  .affirmation {
    height: 100%;
    width: 100%;
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    justify-content: center;
    text-align: center;
    font-size: clamp(9rem, 20vw, 18rem);
    font-family: "Times New Roman", Times, serif;
    font-style: italic;
    line-height: 1;
    letter-spacing: -0.05em;
  }

  .sentence-wrapper {
    position: absolute;
  }

  .sentence {
    line-height: 1;
    text-transform: uppercase;
    display: inline;
  }
</style>
